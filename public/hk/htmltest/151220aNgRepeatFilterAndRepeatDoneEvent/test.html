<!--
http://localhost:3000/hk/htmltest/151220aNgRepeatFilterAndRepeatDoneEvent/test.html
http://jsfiddle.net/tqw6w/
-->

<!DOCTYPE html>
<html lang="en">

<body ng-app="Repeat_Demo" ng-controller="AppCtrl" class="ng-scope">

<h2>repeat-done directive - AngularJS Demo</h2>
	<li ng-repeat="feed in feedList" repeat-done="layoutDone()" ng-cloak>
		<div class='hkhk'>
			<a href="{{feed}}" title="view at {{feed | hostName}}" data-toggle="tooltip">{{feed | strip_http}}</a>
		</div>
	</li>
</body>

<link rel="stylesheet" href="http://www.wingo.com/bootstrap/css/bootstrap.css" type="text/css">
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://www.wingo.com/bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular.min.js"></script>
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>-->
<script type="text/javascript">
	'use strict';
	angular.module('Repeat_Demo', [])
			.directive('repeatDone', function() {
				return function(scope, element, attrs) {
					if (scope.$last) { // all are rendered
						scope.$eval(attrs.repeatDone);
					}
				}
			})
			.filter('strip_http', function() {
				return function(str) {
					var http = "http://";
					return (str.indexOf(http) == 0) ? str.substr(http.length) : str;
				}
			})
			.filter('hostName', function() {
				return function(str) {
					var urlParser = document.createElement('a');
					urlParser.href = str;
					return urlParser.hostname;
				}
			})
			.controller('AppCtrl', function($scope, $timeout) {
				$scope.feedList = [
					'http://feeds.feedburner.com/TEDTalks_video',
					'http://feeds.nationalgeographic.com/ng/photography/photo-of-the-day/',
					'http://sfbay.craigslist.org/eng/index.rss',
					'http://www.slate.com/blogs/trending.fulltext.all.10.rss',
					'http://feeds.current.com/homepage/en_US.rss',
					'http://feeds.current.com/items/popular.rss',
					'http://www.nytimes.com/services/xml/rss/nyt/HomePage.xml'
				];

				$scope.layoutDone = function() {
					//$('a[data-toggle="tooltip"]').tooltip(); // NOT CORRECT!
					alert('in done');
					$timeout(function() { $('a[data-toggle="tooltip"]').tooltip(); }, 0); // wait...
					var stopMusicExt = document.getElementsByClassName("hkhk").length;
					stopMusicExt = document.getElementsByClassName("hkhk").length;
					alert('in done2 ' + stopMusicExt);
				}
			})
</script>

</body>
</html>
